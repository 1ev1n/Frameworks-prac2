# Система управления задачами (микросервисы)

Этот проект представляет собой систему управления задачами для строительной компании, разработанную с использованием микросервисной архитектуры. Он включает в себя API Gateway, Users Service и Orders Service, а также базу данных PostgreSQL, оркестрированные с помощью Docker Compose.

## Архитектура

- **API Gateway**: Единая точка входа для всех клиентских запросов. Выполняет проксирование, JWT валидацию, ограничение частоты запросов (Rate Limiting), CORS и трассировку запросов.
- **Users Service**: Микросервис для управления пользователями, включая регистрацию, аутентификацию (JWT, bcrypt), управление профилями и ролями.
- **Orders Service**: Микросервис для управления заказами, включая создание, получение, обновление статуса и отмену заказов.
- **PostgreSQL**: База данных для хранения информации о пользователях и заказах.
- **Docker & Docker Compose**: Контейнеризация и оркестрация всех сервисов.

## Функциональные требования

### API Gateway:
- Проксирование путей `/users/*` на Users Service
- Проксирование путей `/orders/*` на Orders Service
- JWT валидация для защищенных маршрутов
- Rate limiting (ограничение частоты запросов)
- CORS настройка
- Прокидывание X-Request-ID заголовка для трассировки
- Circuit Breaker для устойчивости к сбоям сервисов

### Users Service:
- `POST /v1/register`: Регистрация нового пользователя с валидацией входных данных, хешированием пароля (bcrypt) и присвоением ролей.
- `POST /v1/login`: Аутентификация пользователя по email и паролю, выдача JWT токена.
- `GET /v1/profile`: Получение профиля текущего пользователя (требуется JWT).
- `PUT /v1/profile`: Обновление профиля текущего пользователя (требуется JWT). Администраторы могут менять роли других пользователей.
- `GET /v1/users`: Получение списка всех пользователей с пагинацией (только для администраторов).

### Orders Service:
- `POST /v1/orders`: Создание нового заказа с валидацией входных данных и привязкой к пользователю (требуется JWT).
- `GET /v1/orders/{id}`: Получение информации о заказе по его ID (доступно владельцу заказа или администратору).
- `GET /v1/orders`: Получение списка заказов с пагинацией, сортировкой и фильтрацией по пользователю (владелец видит свои заказы, администратор - все).
- `PUT /v1/orders/{id}/status`: Обновление статуса заказа (доступно администраторам, владельцы могут отменить свой заказ).
- `DELETE /v1/orders/{id}`: Отмена заказа (доступно владельцу заказа или администратору, только если заказ не выполнен).

## Модели данных

### Пользователь (User):
```typescript
{
  id: UUID,
  email: string,
  passwordHash: string,
  name: string,
  roles: string[], // ['user', 'admin']
  createdAt: Date,
  updatedAt: Date
}
```

### Заказ (Order):
```typescript
{
  id: UUID,
  userId: UUID,
  items: Array<{ product: string, quantity: number }>,
  status: 'created' | 'in_progress' | 'completed' | 'cancelled',
  totalAmount: number,
  createdAt: Date,
  updatedAt: Date
}
```

## Запуск проекта

Для запуска проекта выполните следующие шаги:

1.  **Клонируйте репозиторий:**
    ```bash
    git clone https://github.com/1ev1n/Frameworks-prac2
    cd Frameworks-prac2
    ```

2.  **Запустите Docker Compose:**
    Убедитесь, что у вас установлен Docker и Docker Compose. Затем в корневой директории проекта выполните:
    ```bash
    docker-compose up --build -d
    ```
    Эта команда соберет Docker образы для всех сервисов и запустит их в фоновом режиме, включая базу данных PostgreSQL.

3.  **Доступ к API Gateway:**
    API Gateway будет доступен по адресу `http://localhost:8000`.

4.  **OpenAPI (Swagger) Спецификация:**
    Интерактивная документация API доступна по адресу `http://localhost:8000/api-docs` после запуска всех сервисов.
    Вы также можете найти файл `openapi.yaml` в директории `docs/` и использовать его в любом другом инструменте для просмотра Swagger/OpenAPI (например, [Swagger UI Online](https://editor.swagger.io/)).

